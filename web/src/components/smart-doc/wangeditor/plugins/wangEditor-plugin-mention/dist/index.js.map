{"version":3,"file":"index.js","mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,EAAQG,QAAQ,4BACR,mBAAXC,QAAyBA,OAAOC,IAC9CD,OAAO,CAAC,2BAA4BJ,GACV,iBAAZC,QACdA,QAAiC,wBAAID,EAAQG,QAAQ,4BAErDJ,EAA8B,wBAAIC,EAAQD,EAAiB,WAC5D,CATD,CASGO,MAAM,SAASC,GAClB,O,+CCVAL,EAAOD,QAAUM,C,GCCbC,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaV,QAGrB,IAAIC,EAASM,EAAyBE,GAAY,CAGjDT,QAAS,CAAC,GAOX,OAHAY,EAAoBH,GAAUR,EAAQA,EAAOD,QAASQ,GAG/CP,EAAOD,OACf,CCrBAQ,EAAoBK,EAAI,SAASb,EAASc,GACzC,IAAI,IAAIC,KAAOD,EACXN,EAAoBQ,EAAEF,EAAYC,KAASP,EAAoBQ,EAAEhB,EAASe,IAC5EE,OAAOC,eAAelB,EAASe,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAG3E,ECPAP,EAAoBQ,EAAI,SAASK,EAAKC,GAAQ,OAAOL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,EAAO,ECCtGd,EAAoBkB,EAAI,SAAS1B,GACX,oBAAX2B,QAA0BA,OAAOC,aAC1CX,OAAOC,eAAelB,EAAS2B,OAAOC,YAAa,CAAEC,MAAO,WAE7DZ,OAAOC,eAAelB,EAAS,aAAc,CAAE6B,OAAO,GACvD,E,qFCNO,SAAS,EAAMC,EAAKC,EAAMC,EAAUC,EAAMC,GAE7C,MAAO,CAAEJ,MAAKC,OAAMC,WAAUC,OAAMC,MAAKnB,SADpBJ,IAAToB,OAAqBpB,EAAYoB,EAAKhB,IAEtD,CCHO,MAAMoB,EAAQC,MAAMC,QACpB,SAASC,EAAUC,GACtB,MAAqB,iBAANA,GACE,iBAANA,GACPA,aAAaC,QACbD,aAAaE,MACrB,CCJO,SAASC,EAAMX,EAAMC,EAAUF,GAElC,GADAC,EAAKY,GAAK,6BACE,kBAARb,QAAwCnB,IAAbqB,EAC3B,IAAK,IAAIY,EAAI,EAAGA,EAAIZ,EAASa,SAAUD,EAAG,CACtC,MAAME,EAAQd,EAASY,GACvB,GAAqB,iBAAVE,EACP,SACJ,MAAMC,EAAYD,EAAMf,UACNpB,IAAdoC,GACAL,EAAMK,EAAWD,EAAMd,SAAUc,EAAMhB,IAE/C,CAER,CACO,SAASkB,EAAElB,EAAKmB,EAAGC,GACtB,IACIlB,EACAC,EACAW,EAHAb,EAAO,CAAC,EAgCZ,QA5BUpB,IAANuC,GACU,OAAND,IACAlB,EAAOkB,GAEP,EAASC,GACTlB,EAAWkB,EAEN,EAAaA,GAClBjB,EAAOiB,EAAEC,WAEJD,GAAKA,EAAEpB,MACZE,EAAW,CAACkB,KAGXD,UACD,EAASA,GACTjB,EAAWiB,EAEN,EAAaA,GAClBhB,EAAOgB,EAAEE,WAEJF,GAAKA,EAAEnB,IACZE,EAAW,CAACiB,GAGZlB,EAAOkB,QAGEtC,IAAbqB,EACA,IAAKY,EAAI,EAAGA,EAAIZ,EAASa,SAAUD,EAC3B,EAAaZ,EAASY,MACtBZ,EAASY,GAAK,OAAMjC,OAAWA,OAAWA,EAAWqB,EAASY,QAAIjC,IAO9E,OAJImB,EAAIsB,WAAW,QACC,IAAftB,EAAIe,QAA2B,MAAXf,EAAI,IAAyB,MAAXA,EAAI,IAC3CY,EAAMX,EAAMC,EAAUF,GAEnB,EAAMA,EAAKC,EAAMC,EAAUC,OAAMtB,EAC5C,CC3BA,ICvBA,ECCqC,CACnC0C,aCEF,SAA2CC,GACjC,IAAAC,EAAiCD,EAAM,WAA3BE,EAAqBF,EAAM,SAAjBG,EAAWH,EAAM,OACzCI,EAAYJ,EAkElB,OA/DAI,EAAUH,WAAa,SAAAI,GAIrB,GAFc,EAAAC,UAAUC,iBAAiBH,GACRI,MAAK,SAAAC,GAAQ,OAAAL,EAAUD,OAAOM,EAAjB,IAE5CR,EAAWI,OADb,CAMM,MArBV,SAA0BL,GAGxB,OAFwBA,EAAOU,YAAW,YACY,aAExD,CAiBqCC,CAAiBP,GAA1CQ,EAAS,YAAEC,EAAS,YAElB,MAANR,GACFS,YAAW,WAELF,GAAWA,EAAUR,GAGzBU,YAAW,WACT,SAASC,IACHF,GAAWA,EAAUT,EAC3B,CACAA,EAAUY,KAAK,aAAcD,GAC7BX,EAAUY,KAAK,eAAgBD,GAC/BX,EAAUY,KAAK,SAAUD,GACzBX,EAAUY,KAAK,mBAAoBD,GACnCX,EAAUY,KAAK,mBAAoBD,GAQnCX,EAAUa,GAAG,UANb,SAASC,IACoB,MAAvBd,EAAUe,YACZJ,IACAX,EAAUgB,IAAI,SAAUF,GAE5B,GAEF,GACF,IAIFjB,EAAWI,E,CACb,EAGAD,EAAUF,SAAW,SAAAO,GAEnB,MAAa,YADA,EAAAH,UAAUe,YAAYZ,IAK5BP,EAASO,EAClB,EAGAL,EAAUD,OAAS,SAAAM,GAEjB,MAAa,YADA,EAAAH,UAAUe,YAAYZ,IAK5BN,EAAOM,EAChB,EAEOL,CACT,EDtEEkB,YAAa,CE4CF,CACXC,KAAM,UACNC,WAlDF,SAAuBf,EAAoB/B,EAA0BsB,GAEnE,IAAMyB,EAAW,EAAAnB,UAAUoB,eAAe1B,EAAQS,GAC1CkB,EAASlB,EAAsB,KA0CvC,OAzCAmB,QAAQC,IAAI,OAAQF,GAENjC,EACZ,OACA,CACEoC,MAAO,CACLC,iBAAiB,EACjBC,GAAIL,EAAKK,IAEXC,MAAO,CACLC,WAAY,MACZC,YAAa,MACbC,gBAAiB,sCACjBC,OAAQZ,EACJ,sDACA,wBACJa,aAAc,MACdC,QAAS,QACTC,MAAO,OACPC,OAAQ,OACRC,OAAQ,YAGZ,CACEhD,EAAE,MAAO,CACPiD,IAAKhB,EAAKiB,OACVX,MAAO,CACL,gBAAiB,MACjBO,MAAO,OACPC,OAAQ,OACR,eAAgB,MAChB,SAAY,WACZI,IAAK,QAEPC,QAAS,CACPd,GAAIL,EAAKK,MAGb,UAAGL,EAAKoB,OAId,IFzCEC,YAAa,CGEF,CACXzB,KAAM,UACN0B,WATF,SAAuBxC,EAAoByC,GACnC,MAA4BzC,EAA1B,IAAAlC,MAAAA,OAAK,IAAG,KAAE,EAAE,IAAAoD,KAAAA,OAAI,IAAG,GAAC,EAAC,EACvBwB,EAAUC,mBAAmBC,KAAKC,UAAU3B,IAClD,MAAO,wFAAiFpD,EAAK,wBAAgB4E,EAAO,cAAM5E,EAAK,UACjI,IHEEgF,eAAgB,CFkBI,CACpBC,SAAU,gCACVC,cA1BF,SACEhD,EACA/B,EACAsB,GAIA,IAEI2B,EAFEpD,EAAQkC,EAAKiD,aAAa,eAAiB,GAC3CC,EAAUC,mBAAmBnD,EAAKiD,aAAa,cAAgB,IAErE,IACE/B,EAAO0B,KAAKQ,MAAMF,E,CAClB,MAAOG,GACPnC,EAAOgC,C,CAGT,MAAO,CACLpC,KAAM,UACNhD,MAAK,EACLoD,KAAI,EACJjD,SAAU,CAAC,CAAEC,KAAM,KAEvB,I","sources":["webpack://WangEditorPluginMention/webpack/universalModuleDefinition","webpack://WangEditorPluginMention/external umd {\"commonjs\":\"@wangeditor/editor\",\"commonjs2\":\"@wangeditor/editor\",\"amd\":\"@wangeditor/editor\",\"root\":\"wangEditor\"}","webpack://WangEditorPluginMention/webpack/bootstrap","webpack://WangEditorPluginMention/webpack/runtime/define property getters","webpack://WangEditorPluginMention/webpack/runtime/hasOwnProperty shorthand","webpack://WangEditorPluginMention/webpack/runtime/make namespace object","webpack://WangEditorPluginMention/./node_modules/snabbdom/build/vnode.js","webpack://WangEditorPluginMention/./node_modules/snabbdom/build/is.js","webpack://WangEditorPluginMention/./node_modules/snabbdom/build/h.js","webpack://WangEditorPluginMention/./src/module/parse-elem-html.ts","webpack://WangEditorPluginMention/./src/index.ts","webpack://WangEditorPluginMention/./src/module/index.ts","webpack://WangEditorPluginMention/./src/module/plugin.ts","webpack://WangEditorPluginMention/./src/module/render-elem.ts","webpack://WangEditorPluginMention/./src/module/elem-to-html.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@wangeditor/editor\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@wangeditor/editor\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WangEditorPluginMention\"] = factory(require(\"@wangeditor/editor\"));\n\telse\n\t\troot[\"WangEditorPluginMention\"] = factory(root[\"wangEditor\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__907__) {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__907__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export function vnode(sel, data, children, text, elm) {\n    const key = data === undefined ? undefined : data.key;\n    return { sel, data, children, text, elm, key };\n}\n//# sourceMappingURL=vnode.js.map","export const array = Array.isArray;\nexport function primitive(s) {\n    return (typeof s === \"string\" ||\n        typeof s === \"number\" ||\n        s instanceof String ||\n        s instanceof Number);\n}\n//# sourceMappingURL=is.js.map","import { vnode } from \"./vnode.js\";\nimport * as is from \"./is.js\";\nexport function addNS(data, children, sel) {\n    data.ns = \"http://www.w3.org/2000/svg\";\n    if (sel !== \"foreignObject\" && children !== undefined) {\n        for (let i = 0; i < children.length; ++i) {\n            const child = children[i];\n            if (typeof child === \"string\")\n                continue;\n            const childData = child.data;\n            if (childData !== undefined) {\n                addNS(childData, child.children, child.sel);\n            }\n        }\n    }\n}\nexport function h(sel, b, c) {\n    let data = {};\n    let children;\n    let text;\n    let i;\n    if (c !== undefined) {\n        if (b !== null) {\n            data = b;\n        }\n        if (is.array(c)) {\n            children = c;\n        }\n        else if (is.primitive(c)) {\n            text = c.toString();\n        }\n        else if (c && c.sel) {\n            children = [c];\n        }\n    }\n    else if (b !== undefined && b !== null) {\n        if (is.array(b)) {\n            children = b;\n        }\n        else if (is.primitive(b)) {\n            text = b.toString();\n        }\n        else if (b && b.sel) {\n            children = [b];\n        }\n        else {\n            data = b;\n        }\n    }\n    if (children !== undefined) {\n        for (i = 0; i < children.length; ++i) {\n            if (is.primitive(children[i]))\n                children[i] = vnode(undefined, undefined, undefined, children[i], undefined);\n        }\n    }\n    if (sel.startsWith(\"svg\") &&\n        (sel.length === 3 || sel[3] === \".\" || sel[3] === \"#\")) {\n        addNS(data, children, sel);\n    }\n    return vnode(sel, data, children, text, undefined);\n}\n/**\n * @experimental\n */\nexport function fragment(children) {\n    let c;\n    let text;\n    if (is.array(children)) {\n        c = children;\n    }\n    else if (is.primitive(c)) {\n        text = children;\n    }\n    else if (c && c.sel) {\n        c = [children];\n    }\n    if (c !== undefined) {\n        for (let i = 0; i < c.length; ++i) {\n            if (is.primitive(c[i]))\n                c[i] = vnode(undefined, undefined, undefined, c[i], undefined);\n        }\n    }\n    return vnode(undefined, {}, c, text, undefined);\n}\n//# sourceMappingURL=h.js.map","/**\r\n * @description parse elem html\r\n * @author wangfupeng\r\n */\r\n\r\nimport { DOMElement } from '../utils/dom'\r\nimport { IDomEditor, SlateDescendant, SlateElement } from '@wangeditor/editor'\r\nimport { MentionElement } from './custom-types'\r\n\r\nfunction parseHtml(\r\n  elem: DOMElement,\r\n  children: SlateDescendant[],\r\n  editor: IDomEditor\r\n): SlateElement {\r\n  // elem HTML 结构 <span data-w-e-type=\"mention\" data-w-e-is-void data-w-e-is-inline data-value=\"张三\" data-info=\"xxx\">@张三</span>\r\n\r\n  const value = elem.getAttribute('data-value') || ''\r\n  const rawInfo = decodeURIComponent(elem.getAttribute('data-info') || '')\r\n  let info: any\r\n  try {\r\n    info = JSON.parse(rawInfo)\r\n  } catch (ex) {\r\n    info = rawInfo\r\n  }\r\n\r\n  return {\r\n    type: 'mention',\r\n    value,\r\n    info,\r\n    children: [{ text: '' }], // void node 必须有一个空白 text\r\n  } as MentionElement\r\n}\r\n\r\nconst parseHtmlConf = {\r\n  selector: 'span[data-w-e-type=\"mention\"]',\r\n  parseElemHtml: parseHtml,\r\n}\r\n\r\nexport default parseHtmlConf\r\n","/**\r\n * @description src entry\r\n * @author wangfupeng\r\n */\r\n\r\nimport module from './module/index'\r\n\r\nexport * from './module/custom-types'\r\nexport * from './module/interface'\r\n\r\nexport default module\r\n","/**\r\n * @description mention module entry\r\n * @author wangfupeng\r\n */\r\n\r\nimport { IModuleConf } from '@wangeditor/editor'\r\nimport withMention from './plugin'\r\nimport renderElemConf from './render-elem'\r\nimport elemToHtmlConf from './elem-to-html'\r\nimport parseHtmlConf from './parse-elem-html'\r\n\r\nconst module: Partial<IModuleConf> = {\r\n  editorPlugin: withMention,\r\n  renderElems: [renderElemConf],\r\n  elemsToHtml: [elemToHtmlConf],\r\n  parseElemsHtml: [parseHtmlConf],\r\n}\r\n\r\nexport default module\r\n","/**\r\n * @description mention plugin\r\n * @author wangfupeng\r\n */\r\n\r\nimport { DomEditor, IDomEditor } from '@wangeditor/editor'\r\nimport { IExtendConfig } from './interface'\r\n\r\nfunction getMentionConfig(editor: IDomEditor) {\r\n  const { EXTEND_CONF } = editor.getConfig()\r\n  const { mentionConfig } = EXTEND_CONF as IExtendConfig\r\n  return mentionConfig\r\n}\r\n\r\nfunction withMention<T extends IDomEditor>(editor: T) {\r\n  const { insertText, isInline, isVoid } = editor\r\n  const newEditor = editor\r\n\r\n  // 重写 insertText\r\n  newEditor.insertText = t => {\r\n    // 选过选中了 void 元素\r\n    const elems = DomEditor.getSelectedElems(newEditor)\r\n    const isSelectedVoidElem = elems.some(elem => newEditor.isVoid(elem))\r\n    if (isSelectedVoidElem) {\r\n      insertText(t)\r\n      return\r\n    }\r\n\r\n    // mention 相关配置\r\n    const { showModal, hideModal } = getMentionConfig(newEditor)\r\n\r\n    if (t === '@') {\r\n      setTimeout(() => {\r\n        // 展示 modal （异步，以便准确获取光标位置）\r\n        if (showModal) showModal(newEditor)\r\n\r\n        // 监听，隐藏 modal（异步，等待 modal 渲染后再监听）\r\n        setTimeout(() => {\r\n          function _hide() {\r\n            if (hideModal) hideModal(newEditor)\r\n          }\r\n          newEditor.once('fullScreen', _hide)\r\n          newEditor.once('unFullScreen', _hide)\r\n          newEditor.once('scroll', _hide)\r\n          newEditor.once('modalOrPanelShow', _hide)\r\n          newEditor.once('modalOrPanelHide', _hide)\r\n\r\n          function hideOnChange() {\r\n            if (newEditor.selection != null) {\r\n              _hide()\r\n              newEditor.off('change', hideOnChange) // 及时解绑\r\n            }\r\n          }\r\n          newEditor.on('change', hideOnChange)\r\n        })\r\n      })\r\n    }\r\n\r\n    // 非 '@' 则执行默认行为\r\n    insertText(t)\r\n  }\r\n\r\n  // 重写 isInline\r\n  newEditor.isInline = elem => {\r\n    const type = DomEditor.getNodeType(elem)\r\n    if (type === 'mention') {\r\n      return true\r\n    }\r\n\r\n    return isInline(elem)\r\n  }\r\n\r\n  // 重写 isVoid\r\n  newEditor.isVoid = elem => {\r\n    const type = DomEditor.getNodeType(elem)\r\n    if (type === 'mention') {\r\n      return true\r\n    }\r\n\r\n    return isVoid(elem)\r\n  }\r\n\r\n  return newEditor\r\n}\r\n\r\nexport default withMention\r\n","/**\r\n * @description render elem\r\n * @author wangfupeng\r\n */\r\n\r\nimport { h, VNode } from 'snabbdom'\r\nimport { DomEditor, IDomEditor, SlateElement } from '@wangeditor/editor'\r\nimport { MentionElement } from './custom-types'\r\n\r\nfunction renderMention(elem: SlateElement, children: VNode[] | null, editor: IDomEditor): VNode {\r\n  // 当前节点是否选中\r\n  const selected = DomEditor.isNodeSelected(editor, elem)\r\n  const { info } = elem as MentionElement\r\n  console.log('info', info)\r\n  // 构建 vnode\r\n  const vnode = h(\r\n    'span',\r\n    {\r\n      props: {\r\n        contentEditable: false, // 不可编辑\r\n        id: info.id\r\n      },\r\n      style: {\r\n        marginLeft: '3px',\r\n        marginRight: '3px',\r\n        backgroundColor: 'var(--w-e-textarea-slight-bg-color)',\r\n        border: selected // 选中/不选中，样式不一样\r\n          ? '2px solid var(--w-e-textarea-selected-border-color)' // wangEditor 提供了 css var https://www.wangeditor.com/v5/theme.html\r\n          : '2px solid transparent',\r\n        borderRadius: '3px',\r\n        padding: '0 3px',\r\n        width: '14px',\r\n        height: '14px',\r\n        cursor: 'pointer'\r\n      },\r\n    },\r\n    [\r\n      h('img', {\r\n        src: info.avatar,\r\n        style: {\r\n          'border-radius': '50%',\r\n          width: '12px',\r\n          height: '12px',\r\n          'margin-right': '2px',\r\n          'position': 'relative',\r\n          top: '-2px'\r\n        },\r\n        dataset: {\r\n          id: info.id\r\n        }\r\n      }),\r\n      `${info.name}`\r\n    ])\r\n\r\n  return vnode\r\n}\r\n\r\nconst conf = {\r\n  type: 'mention', // 节点 type ，重要！！！\r\n  renderElem: renderMention,\r\n}\r\n\r\nexport default conf\r\n","/**\r\n * @description elem to html\r\n * @author wangfupeng\r\n */\r\n\r\nimport { SlateElement } from '@wangeditor/editor'\r\nimport { MentionElement } from './custom-types'\r\n\r\n// 生成 html 的函数\r\nfunction mentionToHtml(elem: SlateElement, childrenHtml: string): string {\r\n  const { value = '', info = {} } = elem as MentionElement\r\n  const infoStr = encodeURIComponent(JSON.stringify(info))\r\n  return `<span data-w-e-type=\"mention\" data-w-e-is-void data-w-e-is-inline data-value=\"${value}\" data-info=\"${infoStr}\">@${value}</span>`\r\n}\r\n\r\n// 配置\r\nconst conf = {\r\n  type: 'mention', // 节点 type ，重要！！！\r\n  elemToHtml: mentionToHtml,\r\n}\r\n\r\nexport default conf\r\n"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__907__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","sel","data","children","text","elm","array","Array","isArray","primitive","s","String","Number","addNS","ns","i","length","child","childData","h","b","c","toString","startsWith","editorPlugin","editor","insertText","isInline","isVoid","newEditor","t","DomEditor","getSelectedElems","some","elem","getConfig","getMentionConfig","showModal","hideModal","setTimeout","_hide","once","on","hideOnChange","selection","off","getNodeType","renderElems","type","renderElem","selected","isNodeSelected","info","console","log","props","contentEditable","id","style","marginLeft","marginRight","backgroundColor","border","borderRadius","padding","width","height","cursor","src","avatar","top","dataset","name","elemsToHtml","elemToHtml","childrenHtml","infoStr","encodeURIComponent","JSON","stringify","parseElemsHtml","selector","parseElemHtml","getAttribute","rawInfo","decodeURIComponent","parse","ex"],"sourceRoot":""}