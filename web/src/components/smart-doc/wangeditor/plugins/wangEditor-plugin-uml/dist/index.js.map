{"version":3,"file":"index.js","mappings":"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","sources":["webpack://WangEditorPluginUml/webpack/universalModuleDefinition","webpack://WangEditorPluginUml/external umd {\"commonjs\":\"@wangeditor/editor\",\"commonjs2\":\"@wangeditor/editor\",\"amd\":\"@wangeditor/editor\",\"root\":\"wangEditor\"}","webpack://WangEditorPluginUml/webpack/bootstrap","webpack://WangEditorPluginUml/webpack/runtime/define property getters","webpack://WangEditorPluginUml/webpack/runtime/hasOwnProperty shorthand","webpack://WangEditorPluginUml/webpack/runtime/make namespace object","webpack://WangEditorPluginUml/./src/module/local.ts","webpack://WangEditorPluginUml/./node_modules/snabbdom/build/vnode.js","webpack://WangEditorPluginUml/./node_modules/snabbdom/build/is.js","webpack://WangEditorPluginUml/./node_modules/snabbdom/build/h.js","webpack://WangEditorPluginUml/./src/module/render-elem.ts","webpack://WangEditorPluginUml/./src/module/elem-to-html.ts","webpack://WangEditorPluginUml/./src/module/parse-elem-html.ts","webpack://WangEditorPluginUml/./src/module/menu/InsertUml.ts","webpack://WangEditorPluginUml/./src/constants/icon-svg.ts","webpack://WangEditorPluginUml/./src/module/menu/EditUml.ts","webpack://WangEditorPluginUml/./src/index.ts","webpack://WangEditorPluginUml/./src/module/index.ts","webpack://WangEditorPluginUml/./src/module/plugin.ts","webpack://WangEditorPluginUml/./src/module/menu/index.ts","webpack://WangEditorPluginUml/./src/module/menu/config.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@wangeditor/editor\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@wangeditor/editor\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WangEditorPluginUml\"] = factory(require(\"@wangeditor/editor\"));\n\telse\n\t\troot[\"WangEditorPluginUml\"] = factory(root[\"wangEditor\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__857__) {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__857__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\r\n * @description 多语言\r\n * @author wangfupeng\r\n */\r\n\r\nimport { i18nAddResources } from '@wangeditor/editor'\r\n\r\ni18nAddResources('en', {\r\n  uml: 'UML'\r\n})\r\n\r\ni18nAddResources('zh-CN', {\r\n  uml: '编辑'\r\n})\r\n","export function vnode(sel, data, children, text, elm) {\n    const key = data === undefined ? undefined : data.key;\n    return { sel, data, children, text, elm, key };\n}\n//# sourceMappingURL=vnode.js.map","export const array = Array.isArray;\nexport function primitive(s) {\n    return typeof s === \"string\" ||\n        typeof s === \"number\" ||\n        s instanceof String ||\n        s instanceof Number;\n}\n//# sourceMappingURL=is.js.map","import { vnode } from \"./vnode\";\nimport * as is from \"./is\";\nexport function addNS(data, children, sel) {\n    data.ns = \"http://www.w3.org/2000/svg\";\n    if (sel !== \"foreignObject\" && children !== undefined) {\n        for (let i = 0; i < children.length; ++i) {\n            const child = children[i];\n            if (typeof child === \"string\")\n                continue;\n            const childData = child.data;\n            if (childData !== undefined) {\n                addNS(childData, child.children, child.sel);\n            }\n        }\n    }\n}\nexport function h(sel, b, c) {\n    let data = {};\n    let children;\n    let text;\n    let i;\n    if (c !== undefined) {\n        if (b !== null) {\n            data = b;\n        }\n        if (is.array(c)) {\n            children = c;\n        }\n        else if (is.primitive(c)) {\n            text = c.toString();\n        }\n        else if (c && c.sel) {\n            children = [c];\n        }\n    }\n    else if (b !== undefined && b !== null) {\n        if (is.array(b)) {\n            children = b;\n        }\n        else if (is.primitive(b)) {\n            text = b.toString();\n        }\n        else if (b && b.sel) {\n            children = [b];\n        }\n        else {\n            data = b;\n        }\n    }\n    if (children !== undefined) {\n        for (i = 0; i < children.length; ++i) {\n            if (is.primitive(children[i]))\n                children[i] = vnode(undefined, undefined, undefined, children[i], undefined);\n        }\n    }\n    if (sel[0] === \"s\" &&\n        sel[1] === \"v\" &&\n        sel[2] === \"g\" &&\n        (sel.length === 3 || sel[3] === \".\" || sel[3] === \"#\")) {\n        addNS(data, children, sel);\n    }\n    return vnode(sel, data, children, text, undefined);\n}\n/**\n * @experimental\n */\nexport function fragment(children) {\n    let c;\n    let text;\n    if (is.array(children)) {\n        c = children;\n    }\n    else if (is.primitive(c)) {\n        text = children;\n    }\n    else if (c && c.sel) {\n        c = [children];\n    }\n    if (c !== undefined) {\n        for (let i = 0; i < c.length; ++i) {\n            if (is.primitive(c[i]))\n                c[i] = vnode(undefined, undefined, undefined, c[i], undefined);\n        }\n    }\n    return vnode(undefined, {}, c, text, undefined);\n}\n//# sourceMappingURL=h.js.map","/**\r\n * @description render elem\r\n * @author wangfupeng\r\n */\r\n\r\nimport { h, VNode } from 'snabbdom'\r\nimport { DomEditor, IDomEditor, SlateElement } from '@wangeditor/editor'\r\nimport { UmlElement } from './custom-types'\r\nfunction getObjectValue(obj: any, property: string): any {\r\n  return obj[property];\r\n}\r\nfunction renderUml(elem: SlateElement, children: VNode[] | null, editor: IDomEditor): VNode {\r\n  const isDisabled = editor.isDisabled()\r\n\r\n  // 当前节点是否选中\r\n  const selected = DomEditor.isNodeSelected(editor, elem)\r\n\r\n  // 构建 vnode\r\n  const { src = '', xml = '' } = elem as UmlElement\r\n  const vnode = h(\r\n    'span',\r\n    {\r\n      props: {\r\n        contentEditable: false, // 不可编辑\r\n      },\r\n      style: {\r\n        display: 'inline-block', // inline\r\n        marginLeft: '3px',\r\n        marginRight: '3px',\r\n        border:\r\n          selected && !isDisabled\r\n            ? '2px solid var(--w-e-textarea-selected-border-color)' // wangEditor 提供了 css var https://www.wangeditor.com/v5/theme.html\r\n            : '2px solid transparent',\r\n        borderRadius: '3px',\r\n        padding: '0 3px',\r\n        // backgroundColor: '#f1f1f1',\r\n        cursor: isDisabled ? 'pointer' : 'inherit',\r\n      },\r\n      on: {\r\n        // disable 时，点击下载附件\r\n        click() {\r\n          if (!isDisabled) return\r\n          if (xml) {\r\n            const e = getObjectValue(editor, 'currentBlock').tool.api.events;\r\n            e.emit('mxgraph-open', {\r\n              isUpdate: true,\r\n              xml: xml,\r\n              show: true\r\n            });\r\n          }\r\n        },\r\n      },\r\n    },\r\n    [\r\n      h('img', {\r\n        props: {\r\n          src: src\r\n        },\r\n        style: {\r\n        },\r\n      })\r\n    ]\r\n  )\r\n\r\n  return vnode\r\n}\r\n\r\nconst conf = {\r\n  type: 'uml', // 节点 type ，重要！！！\r\n  renderElem: renderUml,\r\n}\r\n\r\nexport default conf\r\n","/**\r\n * @description elem to html\r\n * @author wangfupeng\r\n */\r\n\r\nimport { SlateElement } from '@wangeditor/editor'\r\nimport { UmlElement } from './custom-types'\r\n\r\n// 生成 html 的函数\r\nfunction umlToHtml(elem: SlateElement, childrenHtml: string): string {\r\n  const { xml = '' ,src= '' } = elem as UmlElement\r\n  const codeXml = encodeURIComponent(xml)\r\n  const html =  `<a data-w-e-type=\"uml\" data-w-e-is-void data-w-e-is-inline data-xml=\"${codeXml}\" data-src=\"${src}\" ></a>`;\r\n  return html;\r\n}\r\n\r\n// 配置\r\nconst conf = {\r\n  type: 'uml', // 节点 type ，重要！！！\r\n  elemToHtml: umlToHtml,\r\n}\r\n\r\nexport default conf\r\n","/**\r\n * @description parse elem html\r\n * @author wangfupeng\r\n */\r\n\r\nimport { DOMElement } from '../utils/dom'\r\nimport { IDomEditor, SlateDescendant, SlateElement } from '@wangeditor/editor'\r\nimport { UmlElement } from './custom-types'\r\n\r\nfunction parseHtml(\r\n  elem: DOMElement,\r\n  children: SlateDescendant[],\r\n  editor: IDomEditor\r\n): SlateElement {\r\n  const xml = elem.getAttribute('data-xml') || ''\r\n  const uncodeXml = decodeURIComponent(xml);\r\n  const src = elem.getAttribute('data-src') || ''\r\n  return {\r\n    type: 'uml',\r\n    xml: uncodeXml,\r\n    src: src,\r\n    children: [{ text: '' }], // void node 必须有一个空白 text\r\n  } as UmlElement\r\n}\r\n\r\nconst parseHtmlConf = {\r\n  selector: 'a[data-w-e-type=\"uml\"]',\r\n  parseElemHtml: parseHtml,\r\n}\r\n\r\nexport default parseHtmlConf\r\n","/**\r\n * @description upload attachment menu\r\n * @author wangfupeng\r\n */\r\n\r\nimport { DomEditor, IDomEditor, SlateRange, t } from '@wangeditor/editor'\r\nimport { IButtonMenu } from '@wangeditor/editor'\r\nimport { UML_SVG } from '../../constants/icon-svg'\r\nimport { insertUml } from './helper'\r\n\r\nclass InsertUMLMenu implements IButtonMenu {\r\n  readonly title = t('uml')\r\n  readonly iconSvg = UML_SVG\r\n  readonly tag = 'button'\r\n\r\n  getValue(editor: IDomEditor): string | boolean {\r\n    // 无需获取 val\r\n    return ''\r\n  }\r\n\r\n  isActive(editor: IDomEditor): boolean {\r\n    // 任何时候，都不用激活 menu\r\n    return false\r\n  }\r\n\r\n  exec(editor: IDomEditor, value: string | boolean) {\r\n    const { } = this.getMenuConfig(editor)\r\n    function getObjectValue(obj: any, property: string) {\r\n      return obj[property];\r\n    }\r\n    //预留，与editorjs 集成\r\n    if ('tool' in editor) {\r\n      const e = getObjectValue(editor, 'tool').api.events;\r\n      e.emit('mxgraph-open', {\r\n        xml: '',\r\n        isUpdate: false,\r\n        show: true\r\n      });\r\n    }\r\n  }\r\n\r\n  isDisabled(editor: IDomEditor): boolean {\r\n    const { selection } = editor\r\n    if (selection == null) return true\r\n    if (SlateRange.isExpanded(selection)) return true // 选区非折叠，禁用\r\n\r\n    const selectedElems = DomEditor.getSelectedElems(editor)\r\n\r\n    const hasVoidElem = selectedElems.some(elem => editor.isVoid(elem))\r\n    if (hasVoidElem) return true // 选中了 void 元素，禁用\r\n\r\n    const hasPreElem = selectedElems.some(elem => DomEditor.getNodeType(elem) === 'pre')\r\n    if (hasPreElem) return true // 选中了 pre 原则，禁用\r\n\r\n    return false\r\n  }\r\n\r\n  private getMenuConfig(editor: IDomEditor) {\r\n    // 获取配置，见 `./config.js`\r\n    return editor.getMenuConfig('insertUML')\r\n  }\r\n}\r\n\r\nexport default InsertUMLMenu\r\n","/**\r\n * @description icon svg\r\n * @author wangfupeng\r\n */\r\n\r\n/**\r\n * 【注意】svg 字符串的长度 ，否则会导致代码体积过大\r\n * 尽量选择 https://www.iconfont.cn/collections/detail?spm=a313x.7781069.0.da5a778a4&cid=20293\r\n * 找不到再从 iconfont.com 搜索\r\n */\r\n\r\n// 附件\r\nexport const UML_SVG = `<svg t=\"1695797780258\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"5167\" id=\"mx_n_1695797780259\" width=\"200\" height=\"200\"><path d=\"M780.007475 65.267493 243.903497 65.267493c-98.642624 0-178.61298 80.013335-178.61298 178.615027l0 536.102954c0 98.774631 79.969333 178.744987 178.61298 178.744987l536.105001 0c98.728582 0 178.700985-79.969333 178.700985-178.744987L958.709483 243.88252C958.70846 145.280828 878.73708 65.267493 780.007475 65.267493zM869.44546 735.353974c0 73.994248-60.119239 134.069485-134.113487 134.069485L288.667004 869.423459c-74.082252 0-134.071532-60.075237-134.071532-134.069485l0-89.307002 178.744987-178.744987 178.615027 223.37751 268.051989-268.050965-89.307002-44.6315L511.955486 556.608987 333.340459 333.319481 154.595472 511.932462 154.595472 288.555975c0-73.992201 59.989279-133.981481 134.071532-133.981481l446.664969 0c73.994248 0 134.113487 59.989279 134.113487 133.981481L869.44546 735.353974z\" p-id=\"5168\"></path></svg>`\r\n// 下载\r\nexport const EDIT_SVG = '<svg viewBox=\"0 0 1024 1024\"><path d=\"M864 0a160 160 0 0 1 128 256l-64 64-224-224 64-64c26.752-20.096 59.968-32 96-32zM64 736l-64 288 288-64 592-592-224-224L64 736z m651.584-372.416l-448 448-55.168-55.168 448-448 55.168 55.168z\"></path></svg>'\r\n","/**\r\n * @description download attachment menu\r\n * @author wangfupeng\r\n */\r\n\r\nimport { DomEditor, IDomEditor, SlateRange, t } from '@wangeditor/editor'\r\nimport { IButtonMenu } from '@wangeditor/editor'\r\nimport { EDIT_SVG } from '../../constants/icon-svg'\r\nimport { UmlElement } from '../custom-types'\r\n\r\nclass EditUmlMenu implements IButtonMenu {\r\n    readonly title = t('uml')\r\n    readonly iconSvg = EDIT_SVG\r\n    readonly tag = 'button'\r\n    readonly alwaysEnable = true\r\n\r\n    getValue(editor: IDomEditor): string | boolean {\r\n        const umlElem = this.getSelectedElem(editor)\r\n        if (umlElem == null) return ''\r\n        return umlElem.xml\r\n    }\r\n\r\n    isActive(editor: IDomEditor): boolean {\r\n        // 任何时候，都不用激活 menu\r\n        return false\r\n    }\r\n\r\n    exec(editor: IDomEditor, value: string | boolean) {\r\n        if (!value) return\r\n        if (typeof value !== 'string') return\r\n        function getObjectValue(obj: any, property: string) {\r\n            return obj[property];\r\n        }\r\n        //预留，与editorjs 集成\r\n        if ('tool' in editor) {\r\n            const e = getObjectValue(editor, 'tool').api.events;\r\n            e.emit('mxgraph-open', {\r\n                isUpdate: true,\r\n                xml: value,\r\n                show: true\r\n            });\r\n        }\r\n    }\r\n\r\n    isDisabled(editor: IDomEditor): boolean {\r\n        const { selection } = editor\r\n        if (selection == null) return true\r\n        if (SlateRange.isExpanded(selection)) return true // 选区非折叠，禁用\r\n\r\n        // 未匹配到 attachment node 则禁用\r\n        const umlElem = this.getSelectedElem(editor)\r\n        if (umlElem == null) return true\r\n\r\n        return false\r\n    }\r\n\r\n    private getSelectedElem(editor: IDomEditor): UmlElement | null {\r\n        const node = DomEditor.getSelectedNodeByType(editor, 'uml')\r\n        if (node == null) return null\r\n        return node as UmlElement\r\n    }\r\n}\r\n\r\nexport default EditUmlMenu","/**\r\n * @description src entry\r\n * @author wangfupeng\r\n */\r\n\r\nimport module from './module/index'\r\n\r\nexport * from './module/custom-types'\r\n\r\nexport default module\r\n","/**\r\n * @description attachment module entry\r\n * @author wangfupeng\r\n */\r\n\r\nimport './local' // 多语言\r\n\r\nimport { IModuleConf } from '@wangeditor/editor'\r\nimport widthUml from './plugin'\r\nimport renderElemConf from './render-elem'\r\nimport elemToHtmlConf from './elem-to-html'\r\nimport parseHtmlConf from './parse-elem-html'\r\nimport { insertUmlMenuConf, editUmlMenuConf } from './menu/index'\r\n\r\nconst module: Partial<IModuleConf> = {\r\n  editorPlugin: widthUml,\r\n  renderElems: [renderElemConf],\r\n  elemsToHtml: [elemToHtmlConf],\r\n  parseElemsHtml: [parseHtmlConf],\r\n  menus: [insertUmlMenuConf, editUmlMenuConf],\r\n}\r\n\r\nexport default module\r\n","/**\r\n * @description attachment plugin\r\n * @author wangfupeng\r\n */\r\n\r\nimport { DomEditor, IDomEditor } from '@wangeditor/editor'\r\n\r\nfunction widthUml<T extends IDomEditor>(editor: T) {\r\n  const { isInline, isVoid } = editor\r\n  const newEditor = editor\r\n\r\n  // 重写 isInline\r\n  newEditor.isInline = elem => {\r\n    const type = DomEditor.getNodeType(elem)\r\n    if (type === 'uml') {\r\n      return true\r\n    }\r\n\r\n    return isInline(elem)\r\n  }\r\n\r\n  // 重写 isVoid\r\n  newEditor.isVoid = elem => {\r\n    const type = DomEditor.getNodeType(elem)\r\n    if (type === 'uml') {\r\n      return true\r\n    }\r\n\r\n    return isVoid(elem)\r\n  }\r\n\r\n  return newEditor\r\n}\r\n\r\nexport default widthUml\r\n","/**\r\n * @description menu entry\r\n * @author wangfupeng\r\n */\r\n\r\nimport InsertUMLMenu from './InsertUml'\r\nimport EditUmlMenu from './EditUml'\r\nimport { genUmlMenuConfig } from './config'\r\n\r\nexport const insertUmlMenuConf = {\r\n  key: 'insertUML', // menu key ，唯一。注册之后，可配置到工具栏\r\n  factory() {\r\n    return new InsertUMLMenu()\r\n  },\r\n\r\n  // 默认的菜单菜单配置，将存储在 editorConfig.MENU_CONF[key] 中\r\n  // 创建编辑器时，可通过 editorConfig.MENU_CONF[key] = {...} 来修改\r\n  config: genUmlMenuConfig(),\r\n}\r\n\r\nexport const editUmlMenuConf = {\r\n  key: 'editUML', // menu key ，唯一。注册之后，可配置到工具栏\r\n  factory() {\r\n    return new EditUmlMenu()\r\n  },\r\n\r\n  // 默认的菜单菜单配置，将存储在 editorConfig.MENU_CONF[key] 中\r\n  // 创建编辑器时，可通过 editorConfig.MENU_CONF[key] = {...} 来修改\r\n  config: genUmlMenuConfig(),\r\n}\r\n\r\n\r\n","/**\r\n * @description menu config\r\n * @author wangfupeng\r\n */\r\n\r\nimport { UmlElement } from '../custom-types'\r\n\r\n\r\nexport function genUmlMenuConfig() {\r\n  return {\r\n    onInsertedUml(elem: UmlElement) {\r\n    },\r\n  }\r\n}\r\n"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__857__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","i18nAddResources","uml","sel","data","children","text","elm","array","Array","isArray","primitive","s","String","Number","addNS","ns","i","length","child","childData","h","b","c","toString","conf","type","renderElem","elem","editor","isDisabled","selected","DomEditor","src","xml","props","contentEditable","style","display","marginLeft","marginRight","border","borderRadius","padding","cursor","on","click","tool","api","events","emit","isUpdate","show","elemToHtml","childrenHtml","codeXml","encodeURIComponent","selector","parseElemHtml","getAttribute","decodeURIComponent","title","t","iconSvg","tag","getValue","isActive","exec","this","getMenuConfig","selection","SlateRange","selectedElems","some","isVoid","alwaysEnable","umlElem","getSelectedElem","node","editorPlugin","isInline","newEditor","renderElems","elemsToHtml","parseElemsHtml","menus","config","onInsertedUml","EditUml"],"sourceRoot":""}